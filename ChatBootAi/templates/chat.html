{% load static %}
{% if user.is_authenticated %}
{% include 'headerTask.html' %}
{% block content %}

<head>
  <title>Chat Me</title>
  <!-- Include Chart.js library --> 

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="{% static 'chatAi/css/chatStyle.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<style>
/* Default for large screens (desktops) */
.responsive-iframe {
    width: 80%;  /* Adjust to your needs */
    height: 500px; /* Adjust to your needs */
}

.responsive-image {
    width: 80%;  /* Adjust to your needs */
    height: auto;
}

/* For tablets */
@media (max-width: 1024px) {
    .responsive-iframe {
        width: 90%;
        height: 400px;
    }
    
    .responsive-image {
        width: 90%;
        height: auto;
    }
}

/* For mobile phones */
@media (max-width: 768px) {
    .responsive-iframe {
        width: 100%;
        height: 300px;
    }

    .responsive-image {
        width: 100%;
        height: auto;
    }
}
  



  /*   -----------------------------------------        */
  .link-black-bg_frame {
      background-color: black;
      color: white; 
      padding: 1px 4px;
      border-radius: 10px;
      text-decoration: none;
  }
  
  .link-black-bg_image {
      background-color: black;
      color: white;  
      max-width: 50%;
      max-height: 50%;
      padding: 1px 4px;
      border-radius: 10px;
      text-decoration: none;
  }

  .message.received {
      word-wrap: break-word; /* Break long words or links */
      overflow-wrap: break-word; /* Break long words when necessary */  
      /* white-space: pre-line; Ensures new lines are respected */
  }
  code, pre {
    background-color: #000;
    color: #fff;
    padding: 2px;
    border-radius: 10px;
    display: block;
     white-space: pre-wrap;  Allows line breaks */
}
.black-bg {
    background-color: black;
    color: white;
    padding: 2px;
    border-radius: 10px;
}
 

</style>

<body>
  
<div class="container my-5">
    <div class="page"> 
  <div class="marvel-device nexus5">
    <div class="top-bar"></div>
    <div class="sleep"></div>
    <div class="volume"></div>
    <div class="camera"></div>
    <div class="screen"> 
      <div class="screen-container"> 
        {% if error != "" %}
          <div class="alert alert-danger" role="alert">
            {{error}}
          </div>
        {% elif success != "" %}
          <div class="alert alert-success" role="alert">
            {{success}}
          </div>
        {% endif %} 
          
        </div>
        <div class="chat">
          <div class="chat-container">
            <div class="user-bar">
              <div class="back">
                <i class="zmdi zmdi-arrow-left"></i>
              </div>
              <div class="avatar">
                <img src="{{BASE_DIR}}/media/chatLogo.png" class="avatar " alt="Avatar">
              </div>
              <div class="name">
                <span>Chat Ai</span> 
                <span class="status">with v. 0.1</span>
              </div>
              <div class="actions more">
                <span class="material-icons">
                        more_vert
                    </span>
              </div>
              <div class="actions attachment">
                 <span class="material-icons">
                        attachment
                    </span>
              </div>
              <div class="actions">
                 <span class="material-icons">
                        phone
                    </span>
              </div>
            </div>
            <div class="conversation y-scale">
              <div class="conversation-container">
                  {% if msg_show|length == 0 %}
                    <div class="message received">
                      <div> "Hello! How can I assist you today? I'm! Ready to assist you. How may I help you?" </div>
                    </div>
                  {% endif %}
                {% for msg in msg_show %}
                <div class="message sent">
                  <div> {{msg.user_input}} </div>
                  <span class="metadata">
                      <span class="time"> {{msg.created_at}} </span>
                  </span>
                </div>
                <div class="message received">
                   
                    {% if msg_show == null %}
                    <div> "Hello ! How can I assist you today?"  </div>
                    {% endif %}
                     <div> {{ msg.bot_response|safe }} </div> 
                  <span class="metadata">
                    <span class="time"> {{msg.created_at}} </span>
                </div>
                 {% endfor %}
                 
              <form class="conversation-compose my-2 " action="{% url 'chatbot' %}" method="post" enctype="multimedia/part">
                {% csrf_token %}
                <div class="emoji">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" id="smiley" x="3147" y="3209"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.153 11.603c.795 0 1.44-.88 1.44-1.962s-.645-1.96-1.44-1.96c-.795 0-1.44.88-1.44 1.96s.645 1.965 1.44 1.965zM5.95 12.965c-.027-.307-.132 5.218 6.062 5.55 6.066-.25 6.066-5.55 6.066-5.55-6.078 1.416-12.13 0-12.13 0zm11.362 1.108s-.67 1.96-5.05 1.96c-3.506 0-5.39-1.165-5.608-1.96 0 0 5.912 1.055 10.658 0zM11.804 1.01C5.61 1.01.978 6.034.978 12.23s4.826 10.76 11.02 10.76S23.02 18.424 23.02 12.23c0-6.197-5.02-11.22-11.216-11.22zM12 21.355c-5.273 0-9.38-3.886-9.38-9.16 0-5.272 3.94-9.547 9.214-9.547a9.548 9.548 0 0 1 9.548 9.548c0 5.272-4.11 9.16-9.382 9.16zm3.108-9.75c.795 0 1.44-.88 1.44-1.963s-.645-1.96-1.44-1.96c-.795 0-1.44.878-1.44 1.96s.645 1.963 1.44 1.963z" fill="#7d8489"/></svg>
                </div>
                <input class="input-msg" name="user_input" placeholder="Type your Query here?" autocomplete="off" autofocus required></input>
                <div class="photo">
                  <i class="zmdi zmdi-camera"></i>
                </div>
                <button class="send" type="submit"> 
                    <div class="circle">
                      <span class="material-icons">
                        send
                    </span>
                    </div>
                  </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
  {% endblock %}
  {% include 'footerTask.html' %}
{% endif %}
<script>
  document.getElementById('chat-form').addEventListener('submit', function() {
      document.getElementById('user_input').value = ''; // Clear the input field after submission
  });
</script>
<script src="{% static 'chatAi/js/chatStyle.js' %}"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- JavaScript to render the chart -->
 
